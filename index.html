<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Auth</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#0b2f2a;
  color:white;
  font-family:system-ui;
}
.card{
  width:360px;
  padding:25px;
  border-radius:16px;
  background:rgba(255,255,255,.12);
}
button,input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:20px;
  border:none;
}
button{cursor:pointer;font-weight:600}
.hidden{display:none}
</style>
</head>

<body>

<div class="card">
  <h3 align="center">Authentication</h3>

  <button onclick="login()">Login with Google</button>
  <button onclick="signup()">Sign Up with Google</button>

  <p id="msg" align="center"></p>

  <div id="extra" class="hidden">
    <input id="name" placeholder="Your name (required)">
    <input type="file" id="photo" accept="image/*">
    <button onclick="completeSignup()">Register</button>
  </div>
</div>

<script>
// ðŸ”¥ Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù‡Ù†Ø§
const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const provider = new firebase.auth.GoogleAuthProvider();

let currentUser = null;

function login(){
  auth.signInWithPopup(provider).then(res=>{
    const email = res.user.email;
    db.collection("users").doc(email).get().then(doc=>{
      if(doc.exists){
        msg("Welcome back!");
      }else{
        auth.signOut();
        msg("This account is not registered. Please sign up first.");
      }
    });
  });
}

function signup(){
  auth.signInWithPopup(provider).then(res=>{
    currentUser = res.user;
    db.collection("users").doc(currentUser.email).get().then(doc=>{
      if(doc.exists){
        msg("This account is already registered.");
      }else{
        msg("Complete your registration.");
        document.getElementById("extra").classList.remove("hidden");
      }
    });
  });
}

function completeSignup(){
  const name = document.getElementById("name").value;
  if(!name){ msg("Name is required."); return; }

  db.collection("users").doc(currentUser.email).set({
    name: name,
    email: currentUser.email,
    photo: currentUser.photoURL || ""
  }).then(()=>{
    msg("Registration successful. You are now logged in.");
    document.getElementById("extra").classList.add("hidden");
  });
}

function msg(t){
  document.getElementById("msg").innerText = t;
}
</script>

</body>
</html>
